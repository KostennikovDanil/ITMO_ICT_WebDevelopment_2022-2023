<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Lab 4 - Kostennikov documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="../assets/_mkdocstrings.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Lab 4";
        var mkdocs_page_input_path = "lr4.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> Kostennikov documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../lr1/">Lab 1</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../lr2/">Lab 2</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../lr3/">Lab 3</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="./">Lab 4</a>
    <ul class="current">
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../pr3.1/">Practice</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Kostennikov documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" alt="Docs"></a> &raquo;</li>
      <li>Lab 4</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="lab-3">Lab 3</h1>
<p>Реализация клиентской части приложения средствами vue.js.</p>
<h1 id="api">API</h1>
<h3 id="_1">Авторизация</h3>
<pre><code class="language-javascript">class UserApi {
  constructor(instance) {
    this.API = instance;
  }

  register = async (data) =&gt; {
    return this.API({
      method: &quot;POST&quot;,
      url: &quot;/auth/users/&quot;,
      data,
      headers: {
        &quot;Content-Type&quot;: &quot;application/json&quot;,
      },
    });
  };

  login = async (data) =&gt; {
    return this.API({
      method: &quot;POST&quot;,
      url: &quot;/auth/token/login/&quot;,
      data,
      headers: {
        &quot;Content-Type&quot;: &quot;application/json&quot;,
      },
    });
  };

  logout = async (token) =&gt; {
    return this.API({
      method: &quot;POST&quot;,
      url: &quot;/auth/token/logout/&quot;,
      headers: {
        Authorization: `Token ${token}`,
      },
    });
  };
}

export default UserApi;
</code></pre>
<h3 id="_2">Количество свободных комнат</h3>
<pre><code class="language-javascript">class RoomsApi {
  constructor(instance) {
    this.API = instance;
  }

  freeRooms = async (date) =&gt; {
    return this.API({
      url: `/free_rooms/${date}`,
      headers: {
        &quot;Content-Type&quot;: &quot;application/json&quot;,
      },
    });
  };
}

export default RoomsApi;
</code></pre>
<h3 id="_3">Количество клиентов из заданного города</h3>
<pre><code class="language-javascript">class ClientApi {
  constructor(instance) {
    this.API = instance;
  }

  clientCityCount = async (data) =&gt; {
    return this.API({
      url: `/client/${data}`,
      headers: {
        &quot;Content-Type&quot;: &quot;application/json&quot;,
      },
    });
  };
}

export default ClientApi;
</code></pre>
<h1 id="stores">Stores</h1>
<h3 id="user-store">user store</h3>
<pre><code class="language-javascript">import { defineStore } from &quot;pinia&quot;;
import { userApi } from &quot;@/api&quot;;

const usersStore = defineStore(&quot;users&quot;, {
  state: () =&gt; ({
    user: null,
    token: null,
  }),

  actions: {
    async register(user) {
      console.log(&quot;in store&quot;, user);
      const response = await userApi.register(user);
      console.log(&quot;in store response&quot;, response);
      return response.data;
    },

    async login(credentials) {
      const response = await userApi.login(credentials);
      this.user = {
        username: credentials.username,
        password: credentials.password,
      };
      this.token = response.data.auth_token;
      return response;
    },

    async logout() {
      if (this.token) {
        this.token = null;
        this.user = null;
        this.$router.push(&quot;Navbar&quot;);
        return true;
      }
    },
  },
});

export default usersStore;
</code></pre>
<h3 id="rooms-store">rooms store</h3>
<pre><code class="language-javascript">import { defineStore } from &quot;pinia&quot;;
// импортируем API
import { roomsApi } from &quot;@/api&quot;;

const userRoomsStore = defineStore(&quot;rooms&quot;, {
  state: () =&gt; ({
    date: &quot;&quot;,
    rooms: &quot;&quot;,
  }),

  actions: {
    async loadFreeRooms(date) {
      const response = await roomsApi.freeRooms(date);
      this.date = date;
      this.rooms = JSON.stringify(response.data.count);
      return response;
    },
  },
});

export default userRoomsStore;
</code></pre>
<h3 id="client-store">client store</h3>
<pre><code class="language-javascript">import { defineStore } from &quot;pinia&quot;;
// импортируем API
import { clientApi } from &quot;@/api&quot;;

const clientStore = defineStore(&quot;rooms&quot;, {
  state: () =&gt; ({
    city: &quot;&quot;,
    count: &quot;&quot;,
  }),

  actions: {
    async loadClientCityCount(data) {
      const response = await clientApi.clientCityCount(data);
      this.city = data;
      this.count = JSON.stringify(response.data.count);
      return response;
    },
  },
});

export default clientStore;
</code></pre>
<h1 id="components">Components</h1>
<h3 id="navbar">Navbar</h3>
<pre><code class="language-vue">&lt;template&gt;
  &lt;nav class=&quot;navbar navbar-expand-sm bg-dark navbar-dark&quot;&gt;
    &lt;div class=&quot;container-fluid&quot;&gt;
      &lt;a class=&quot;navbar-brand&quot;&gt;Hotel app&lt;/a&gt;
      &lt;div class=&quot;collapse navbar-collapse&quot; id=&quot;collapsibleNavbar&quot;&gt;
        &lt;ul class=&quot;navbar-nav&quot;&gt;
          &lt;li v-if=&quot;user&quot; class=&quot;nav-item&quot;&gt;
            &lt;router-link class=&quot;nav-link active&quot; to=&quot;/freeRooms&quot;
              &gt;&lt;a&gt;Free rooms&lt;/a&gt;&lt;/router-link
            &gt;
          &lt;/li&gt;
          &lt;li v-if=&quot;user&quot; class=&quot;nav-item&quot;&gt;
            &lt;router-link class=&quot;nav-link active&quot; to=&quot;/clientCity&quot;
              &gt;&lt;a&gt;Client city count&lt;/a&gt;&lt;/router-link
            &gt;
          &lt;/li&gt;
        &lt;/ul&gt;
      &lt;/div&gt;
      &lt;div class=&quot;collapse navbar-collapse justify-content-end&quot; id=&quot;navbarNav&quot;&gt;
        &lt;ul class=&quot;navbar-nav&quot;&gt;
          &lt;li v-if=&quot;!user&quot; class=&quot;nav-item auth_link&quot;&gt;
            &lt;router-link class=&quot;nav-link active&quot; to=&quot;/login&quot;&gt;
              &lt;a class=&quot;nav-link&quot;&gt;Login&lt;/a&gt;&lt;/router-link
            &gt;
          &lt;/li&gt;
          &lt;li v-if=&quot;!user&quot; class=&quot;nav-item auth_link&quot;&gt;
            &lt;router-link class=&quot;nav-link active&quot; to=&quot;/register&quot;&gt;
              &lt;a class=&quot;nav-link&quot;&gt;Register&lt;/a&gt;&lt;/router-link
            &gt;
          &lt;/li&gt;
          &lt;li v-if=&quot;user&quot; class=&quot;nav-item profile_link&quot;&gt;
            &lt;router-link class=&quot;nav-link active&quot; to=&quot;/navbar&quot;&gt;
              &lt;a class=&quot;nav-link&quot; @click=&quot;logout&quot; href=&quot;#&quot;&gt;LogOut&lt;/a&gt;
            &lt;/router-link&gt;
          &lt;/li&gt;
        &lt;/ul&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/nav&gt;
&lt;/template&gt;

&lt;script&gt;
import { mapActions, mapState } from &quot;pinia&quot;;
import usersStore from &quot;@/stores/user&quot;;

export default {
  name: &quot;Navbar&quot;,
  computed: {
    ...mapState(usersStore, [&quot;user&quot;, &quot;token&quot;]),
  },

  methods: {
    ...mapActions(usersStore, [&quot;logout&quot;, &quot;login&quot;]),
  },
};
&lt;/script&gt;
</code></pre>
<h3 id="login">Login</h3>
<pre><code class="language-vue">&lt;template&gt;
  &lt;form ref=&quot;registerForm&quot; @submit.prevent=&quot;loginForm&quot;&gt;
    &lt;div&gt;
      &lt;label for=&quot;username&quot;&gt;Username:&lt;/label&gt;
      &lt;input type=&quot;text&quot; id=&quot;username&quot; v-model=&quot;username&quot; required /&gt;
    &lt;/div&gt;
    &lt;div&gt;
      &lt;label for=&quot;password&quot;&gt;Password:&lt;/label&gt;
      &lt;input type=&quot;password&quot; id=&quot;password&quot; v-model=&quot;password&quot; required /&gt;
    &lt;/div&gt;
    &lt;div&gt;
      &lt;button type=&quot;submit&quot; class=&quot;btn btn-primary&quot;&gt;Login&lt;/button&gt;
    &lt;/div&gt;
  &lt;/form&gt;
&lt;/template&gt;

&lt;script&gt;
import { mapActions, mapState } from &quot;pinia&quot;;
import usersStore from &quot;@/stores/user&quot;;
export default {
  name: &quot;Login&quot;,
  data() {
    return {
      username: &quot;&quot;,
      password: &quot;&quot;,
    };
  },
  methods: {
    ...mapActions(usersStore, [&quot;login&quot;]),
    async loginForm() {
      try {
        const response = await this.login({
          username: this.username,
          password: this.password,
        });
        this.$refs.registerForm.reset();
        this.$router.push(&quot;Navbar&quot;);
      } catch (error) {
        alert(&quot;wrong username or password&quot;);
      }
    },
  },
};
&lt;/script&gt;
</code></pre>
<h3 id="register">Register</h3>
<pre><code class="language-vue">&lt;template&gt;
  &lt;form ref=&quot;registerForm&quot; @submit.prevent=&quot;registerForm&quot;&gt;
    &lt;div&gt;
      &lt;label for=&quot;username&quot;&gt;Username:&lt;/label&gt;
      &lt;input type=&quot;text&quot; id=&quot;username&quot; v-model=&quot;username&quot; required /&gt;
    &lt;/div&gt;
    &lt;div&gt;
      &lt;label for=&quot;email&quot;&gt;Email:&lt;/label&gt;
      &lt;input type=&quot;text&quot; id=&quot;email&quot; v-model=&quot;email&quot; required /&gt;
    &lt;/div&gt;
    &lt;div&gt;
      &lt;label for=&quot;password&quot;&gt;Password:&lt;/label&gt;
      &lt;input type=&quot;password&quot; id=&quot;password&quot; v-model=&quot;password&quot; required /&gt;
    &lt;/div&gt;
    &lt;div&gt;
      &lt;button type=&quot;submit&quot; class=&quot;btn btn-primary&quot;&gt;Register&lt;/button&gt;
    &lt;/div&gt;
  &lt;/form&gt;
&lt;/template&gt;

&lt;script&gt;
import { mapActions, mapState } from &quot;pinia&quot;;
import usersStore from &quot;@/stores/user&quot;;
export default {
  name: &quot;Register&quot;,
  data() {
    return {
      username: &quot;&quot;,
      password: &quot;&quot;,
      email: &quot;&quot;,
    };
  },
  methods: {
    ...mapActions(usersStore, [&quot;register&quot;, &quot;login&quot;]),
    async registerForm() {
      try {
        const response = await this.register({
          username: this.username,
          email: this.email,
          password: this.password,
        });
        this.$refs.registerForm.reset();

        await this.login({
          username: this.username,
          password: this.password,
        });
        this.$router.push(&quot;Navbar&quot;);
      } catch (error) {
        alert(&quot;something went wrong&quot;);
      }
    },
  },
};
&lt;/script&gt;
</code></pre>
<h3 id="clientcity">ClientCity</h3>
<pre><code class="language-vue">&lt;template&gt;
  &lt;div class=&quot;free-rooms-count&quot;&gt;
    &lt;h5 class=&quot;free-rooms-title&quot;&gt;For the city of {{ city }}&lt;/h5&gt;
    &lt;h5 class=&quot;free-rooms-count&quot;&gt;Amount of clients: {{ count }}&lt;/h5&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
export default {
  name: &quot;ClientCity&quot;,
  props: {
    city: {
      type: String,
      required: true,
    },
    count: {
      type: String,
      required: true,
    },
  },
};
&lt;/script&gt;
</code></pre>
<h3 id="freerooms">FreeRooms</h3>
<pre><code class="language-vue">&lt;template&gt;
  &lt;div class=&quot;free-rooms-count&quot;&gt;
    &lt;h5 class=&quot;free-rooms-title&quot;&gt;For the date {{ date }}&lt;/h5&gt;
    &lt;h5 class=&quot;free-rooms-count&quot;&gt;Amount of free rooms: {{ text }}&lt;/h5&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
export default {
  name: &quot;FreeRooms&quot;,
  props: {
    text: {
      type: String,
      required: true,
    },
    date: {
      type: String,
      required: true,
    },
  },
};
&lt;/script&gt;
</code></pre>
<h1 id="views">Views</h1>
<h3 id="clientcitypage">ClientCityPage</h3>
<pre><code class="language-vue">&lt;template&gt;
  &lt;HeaderComponent&gt; &lt;/HeaderComponent&gt;
  &lt;a&gt;&lt;/a&gt;
  &lt;h1&gt;Amount of client from current city&lt;/h1&gt;

  &lt;form
    ref=&quot;noteForm&quot;
    @submit.prevent=&quot;createCard&quot;
    class=&quot;d-flex flex-column my-5&quot;
  &gt;
    &lt;input type=&quot;text&quot; v-model=&quot;form.cityForm&quot; class=&quot;my-1&quot; /&gt;

    &lt;button type=&quot;submit&quot; class=&quot;btn btn-primary&quot;&gt;Отправить&lt;/button&gt;
  &lt;/form&gt;

  &lt;div class=&quot;row row-cols-1 row-cols-md-2 g-4 mt-5&quot; id=&quot;notes&quot;&gt;
    &lt;div&gt;
      &lt;client-city :city=&quot;this.city&quot; :count=&quot;this.count&quot; /&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
import BaseLayout from &quot;@/layouts/BaseLayout.vue&quot;;
import ClientCity from &quot;@/components/ClientCity.vue&quot;;
import HeaderComponent from &quot;@/components/Navbar.vue&quot;;
import { mapActions, mapState } from &quot;pinia&quot;;

import clientStore from &quot;@/stores/client&quot;;

export default {
  name: &quot;ClientCityPage&quot;,

  components: { BaseLayout, ClientCity, HeaderComponent },

  computed: {
    ...mapState(clientStore, [&quot;city&quot;, &quot;count&quot;]),
  },

  methods: {
    ...mapActions(clientStore, [&quot;loadClientCityCount&quot;]),

    async createCard() {
      console.log(this.form);
      console.log(this.form.cityForm);
      console.log(this.form.cityForm);
      await this.loadClientCityCount(this.form.cityForm);

      this.$refs.noteForm.reset();
      console.log(this.city);
      console.log(this.count);
    },
  },

  data() {
    return {
      form: {
        cityForm: &quot;&quot;,
      },
    };
  },

  mounted() {
    if (localStorage.getItem(&quot;reloaded&quot;)) {
      // The page was just reloaded. Clear the value from local storage
      // so that it will reload the next time this page is visited.
      localStorage.removeItem(&quot;reloaded&quot;);
    } else {
      // Set a flag so that we know not to reload the page twice.
      localStorage.setItem(&quot;reloaded&quot;, &quot;1&quot;);
      location.reload();
    }
  },
};
&lt;/script&gt;
</code></pre>
<h3 id="freeroomspage">FreeRoomsPage</h3>
<pre><code class="language-vue">&lt;template&gt;
  &lt;HeaderComponent&gt; &lt;/HeaderComponent&gt;
  &lt;a&gt;&lt;/a&gt;
  &lt;h1&gt;Amount of free rooms on current date&lt;/h1&gt;

  &lt;form
    ref=&quot;noteForm&quot;
    @submit.prevent=&quot;createCard&quot;
    class=&quot;d-flex flex-column my-5&quot;
  &gt;
    &lt;input type=&quot;text&quot; v-model=&quot;form.date&quot; class=&quot;my-1&quot; /&gt;

    &lt;button type=&quot;submit&quot; class=&quot;btn btn-primary&quot;&gt;Отправить&lt;/button&gt;
  &lt;/form&gt;

  &lt;div class=&quot;row row-cols-1 row-cols-md-2 g-4 mt-5&quot; id=&quot;notes&quot;&gt;
    &lt;div&gt;
      &lt;free-rooms :date=&quot;date&quot; :text=&quot;rooms&quot; /&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
import BaseLayout from &quot;@/layouts/BaseLayout.vue&quot;;
import FreeRooms from &quot;@/components/FreeRooms.vue&quot;;
import HeaderComponent from &quot;@/components/Navbar.vue&quot;;
import { mapActions, mapState } from &quot;pinia&quot;;

import userRoomsStore from &quot;@/stores/rooms&quot;;

export default {
  name: &quot;FreeRoomsPage&quot;,

  components: { BaseLayout, FreeRooms, HeaderComponent },

  computed: {
    ...mapState(userRoomsStore, [&quot;rooms&quot;, &quot;date&quot;]),
  },

  methods: {
    ...mapActions(userRoomsStore, [&quot;loadFreeRooms&quot;]),

    async createCard() {
      console.log(this.form);
      console.log(this.form.date);
      await this.loadFreeRooms(this.form.date);

      this.$refs.noteForm.reset();
      console.log(this.rooms);
    },
  },

  data() {
    return {
      form: {
        date: &quot;&quot;,
      },
    };
  },

  mounted() {
    if (localStorage.getItem(&quot;reloaded&quot;)) {
      // The page was just reloaded. Clear the value from local storage
      // so that it will reload the next time this page is visited.
      localStorage.removeItem(&quot;reloaded&quot;);
    } else {
      // Set a flag so that we know not to reload the page twice.
      localStorage.setItem(&quot;reloaded&quot;, &quot;1&quot;);
      location.reload();
    }
  },
};
&lt;/script&gt;
</code></pre>
<h1 id="router">Router</h1>
<pre><code class="language-javascript">import FreeRoomsPage from &quot;@/views/FreeRoomsPage.vue&quot;;
import clientCityPage from &quot;@/views/clientCityPage.vue&quot;;
import RegisterComponent from &quot;@/components/Register.vue&quot;;
import LoginComponent from &quot;@/components/Login.vue&quot;;
import Navbar from &quot;@/components/Navbar.vue&quot;;
import { createRouter, createWebHistory } from &quot;vue-router&quot;;

const routes = [
  // массив с роутами
  // отдельный роут:
  { path: &quot;/freeRooms&quot;, component: FreeRoomsPage },
  { path: &quot;/register&quot;, component: RegisterComponent },
  { path: &quot;/login&quot;, component: LoginComponent },
  { path: &quot;/navbar&quot;, component: Navbar },
  { path: &quot;/clientCity&quot;, component: clientCityPage },
];

const router = createRouter({
  history: createWebHistory(),
  routes,
});

export default router;
</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../lr3/" class="btn btn-neutral float-left" title="Lab 3"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../pr3.1/" class="btn btn-neutral float-right" title="Practice">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../lr3/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../pr3.1/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
